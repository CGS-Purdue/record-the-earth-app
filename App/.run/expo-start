#!/bin/bash

# EXPO HELPER
# -------------
BASE_DIR="$(npm prefix)"
BIN_DIR="$(npm bin)"

[[ -f .npmrc ]] && source .npmrc
[[ -f .env ]] && source .env

DEBUG_LOGGING="yes"
EXPO_HOST="localhost"

[[ -f .npmrc ]] && source .npmrc
[[ -f .env ]] && source .env

DEBUG_LOGGING="yes"

unset RUN_EXPO_ENV
unset RUN_NODE_ENV

[[ ! -z $NODE_ENV ]] && RUN_NODE_ENV="${RUN_NODE_ENV},NODE_ENV=${NODE_ENV}"
[[ ! -z $NODE_PATH ]] && RUN_NODE_ENV="${RUN_NODE_ENV},NODE_PATH=${NODE_PATH}"
[[ ! -z $NODE_DEBUG ]] && RUN_NODE_ENV="${RUN_NODE_ENV},NODE_DEBUG=${NODE_DEBUG}"
[[ ! -z $NODE_OPTIONS ]] && RUN_NODE_ENV="${RUN_NODE_ENV},NODE_OPTIONS=${NODE_OPTIONS}"

[[ ! -z $NODE_PATH ]] && RUN_EXPO_ENV="${RUN_EXPO_ENV},NODE_PATH=${NODE_PATH}"
[[ ! -z $NODE_OPTIONS ]] && RUN_EXPO_ENV="${RUN_EXPO_ENV},NODE_OPTIONS=${NODE_OPTIONS}"
[[ ! -z $NODE_DEBUG ]] && RUN_EXPO_ENV="${RUN_EXPO_ENV},NODE_DEBUG=${NODE_DEBUG}"
[[ ! -z $DEBUG_LOGGING ]] && RUN_EXPO_ENV="${RUN_EXPO_ENV},DEBUG_LOGGING=${DEBUG_LOGGING}"
[[ ! -z $REACT_DEBUGGER ]] && RUN_EXPO_ENV="${RUN_EXPO_ENV},REACT_DEBUGGER=${REACT_DEBUGGER}"
[[ ! -z $REACT_EDITOR ]] && RUN_EXPO_ENV="${RUN_EXPO_ENV},REACT_EDITOR=${REACT_EDITOR}"
[[ ! -z $EXPO_DEBUG ]] && RUN_EXPO_ENV="${RUN_EXPO_ENV},EXPO_DEBUG=${EXPO_DEBUG}"

RUN_NODE_ENV="${RUN_NODE_ENV//,/ }"
RUN_EXPO_ENV="${RUN_EXPO_ENV//,/ }"

# RUN_EXPO_ENV=""
# RUN_EXPO_ENV="${RUN_EXPO_ENV} DEBUG_LOGGING=\"${DEBUG_LOGGING}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} NODE_PATH=\"${NODE_PATH}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} NODE_ENV=\"${NODE_ENV}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} NODE_DEBUG=\"${NODE_DEBUG}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} NODE_OPTIONS=\"${NODE_OPTIONS}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} EXPO_DEBUG=\"${EXPO_DEBUG}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} APP_DEBUG_APPDATA=\"${APP_DEBUG_APPDATA}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} REACT_DEBUGGER=\"${REACT_DEBUGGER}\" "
# RUN_EXPO_ENV="${RUN_EXPO_ENV} REACT_EDITOR=\"${REACT_EDITOR}\" "

# RUN_EXPO_FLAGS="$@"
EXPO_HOST="localhost"

RUN_EXPO_FLAGS="--clear"
RUN_EXPO_FLAGS="${RUN_EXPO_FLAGS} --max-workers 5"
RUN_EXPO_FLAGS="${RUN_EXPO_FLAGS} --no-minify"
RUN_EXPO_FLAGS="${RUN_EXPO_FLAGS} --no-https"
RUN_EXPO_FLAGS="${RUN_EXPO_FLAGS} --dev"
RUN_EXPO_FLAGS="${RUN_EXPO_FLAGS} --host localhost"
RUN_EXPO_FLAGS="${RUN_EXPO_FLAGS} --android"


DEBUG_LOGGING="${DEBUG_LOGGING}" \
APP_DEBUG_APPDATA="${APP_DEBUG_APPDATA}" \
NODE_PATH="${NODE_PATH}" \
NODE_ENV="${NODE_ENV}" \
NODE_OPTIONS="${NODE_OPTIONS}" \
NODE_DEBUG="${NODE_DEBUG}" \
REACT_DEBUGGER=${REACT_DEBUGGER} \
REACT_EDITOR="${REACT_EDITOR}" \
EXPO_DEBUG="${EXPO_DEBUG}" \
  node ${BASE_DIR}/node_modules/.bin/expo start ${RUN_EXPO_FLAGS}
echo -e "NODE ENV:\n${RUN_NODE_ENV}"
echo -e "EXPO ENV:\n${RUN_EXPO_ENV}"
echo -e "EXPO FLAGS:\n${RUN_EXPO_FLAGS}"



#    --clear \
#    --max-workers 5 \
#    --no-minify \
#    --no-https \
#    --dev \
#    --host localhost \
#    --android
