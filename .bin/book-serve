#!/bin/bash

BASE_DIR="$(npm prefix)"

SERVE_TARGET="${1:-current}"

BOOK_OUTPUT_DIR="deploy"
BOOK_DEPLOY_DIR="${BOOK_OUTPUT_DIR}/${SERVE_TARGET}"

# ALLOW LOCAL .NPMRC OR .ENV FILE TO OVERRIDE
if [ -f "$(npm prefix)/.npmrc" ]; then
  echo "Loading project env"
  . "$(npm prefix)/.npmrc"
fi

##
# SERVE THE EXPORTED STATIC STORYBOOK FILES OUTSDIE OF THE STORYBOOK FRAMEWORK
# CURRENTLY SERVES THE VERSION THAT MATCHES THE NPM PACKAGE VERSION
# THIS MAY CHANGE IN THE FUTURE SINCE WE NEED TO BE ABLE TO SEE
# BOTH THE MOST RECENTLY EXPORTED FILES AND PREVIEW THE CURRENT VERSION
# THAT WILL BE UPDATED TO THE PUBLIC REPOSITORY

echo "npx serve --listen 5000 $BOOK_DEPLOY_DIR"

npx serve --listen 5000 $BOOK_DEPLOY_DIR
